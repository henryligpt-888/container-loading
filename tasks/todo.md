# 3D 智能装箱模拟器 - 任务清单

## 🎯 项目状态

**当前版本**: v0.0.0
**项目阶段**: 初始发布
**最后更新**: 2025-01-21

---

## ✅ 已完成功能

### 核心功能
- [x] 基础 3D 场景渲染（Three.js + React Three Fiber）
- [x] 货物添加与管理（支持批量添加）
- [x] 6 种标准集装箱规格支持（20GP/40GP/40HQ/45HQ/20RF/40RF）
- [x] 贪心式装箱算法实现
- [x] 易碎品约束（禁止上方堆叠）
- [x] 实时统计仪表盘（空间利用率、重量、装载数量）
- [x] 交互式 3D 控制（旋转、缩放、平移）
- [x] 货物悬停显示详情
- [x] 重置装箱方案功能
- [x] 清空货物列表功能

### 用户界面
- [x] 响应式布局设计
- [x] 12 种预设货物颜色
- [x] 货物状态指示（已装入/未装入）
- [x] 装箱计算进度提示
- [x] 易碎品视觉标记（红色顶面 + 标签）
- [x] 集装箱半透明墙体渲染
- [x] 货物边缘线条增强

### 技术实现
- [x] TypeScript 严格模式
- [x] 组件化架构（React Hooks）
- [x] useMemo 性能优化
- [x] 异步计算避免阻塞
- [x] Vite 快速构建配置

---

## 🚧 待完成任务

### 优先级 P0（紧急且重要）

#### 功能缺陷修复
- [ ] **修复：大货物超出边界不报错**
  - 文件: `services/packingAlgorithm.ts`
  - 问题: 当货物尺寸大于集装箱时，应提前警告
  - 解决方案: 在 `handleAdd` 中添加预检查
  ```typescript
  if (l > currentContainer.width ||
      w > currentContainer.depth ||
      h > currentContainer.height) {
    alert('货物尺寸超过集装箱最大尺寸！');
    return;
  }
  ```

- [ ] **修复：重量超载无明显警告**
  - 文件: `App.tsx`
  - 问题: 重量超载仅颜色变红，用户可能忽略
  - 解决方案: 添加弹窗警告 + 禁用添加按钮
  ```typescript
  if (totalWeight > currentContainer.maxLoad) {
    // 显示警告提示
  }
  ```

#### 用户体验改进
- [ ] **添加：装箱失败原因提示**
  - 文件: `ControlPanel.tsx`
  - 需求: 显示哪些货物未装入及原因（空间不足/重量超限）
  - 实现位置: 货物列表下方添加失败详情面板

- [ ] **优化：货物列表滚动性能**
  - 文件: `ControlPanel.tsx:255`
  - 问题: 超过 100 件货物时滚动卡顿
  - 解决方案: 使用虚拟滚动库（react-window）

---

### 优先级 P1（重要但不紧急）

#### 新功能开发
- [ ] **货物旋转功能**
  - **工作量**: 3-5 天
  - **需求描述**: 支持货物 6 种朝向（长宽高三维旋转）
  - **实现步骤**:
    1. 修改 `BoxItem` 接口添加 `rotation` 字段
    2. 更新算法支持旋转尝试
    3. UI 添加旋转控制按钮
  - **参考文档**: BLUEPRINT.md § 改进建议

- [ ] **撤销/重做功能**
  - **工作量**: 2-3 天
  - **技术方案**:
    - 使用命令模式（Command Pattern）
    - 维护操作历史栈
  - **涉及文件**:
    - 新建 `hooks/useHistory.ts`
    - 修改 `App.tsx` 集成 Hook
  - **UI 位置**: 控制面板底部添加撤销/重做按钮

- [ ] **装箱方案导出**
  - **工作量**: 1-2 天
  - **导出格式**:
    - JSON（完整数据）
    - PDF（可视化报告）
  - **库依赖**:
    - `jsPDF`（PDF 生成）
    - `html2canvas`（3D 场景截图）
  - **实现位置**: `ControlPanel.tsx` 添加导出按钮

- [ ] **装箱方案保存/加载**
  - **工作量**: 2 天
  - **存储方式**:
    - LocalStorage（本地缓存）
    - 文件上传/下载（JSON）
  - **涉及文件**: 新建 `utils/storage.ts`

#### 算法优化
- [ ] **候选点优化**
  - **文件**: `services/packingAlgorithm.ts`
  - **问题**: 候选点数量无限增长，影响性能
  - **解决方案**:
    - 定期清理无效点（超出边界/被覆盖）
    - 限制最大候选点数量（如 1000）
  - **预期收益**: 大量货物场景性能提升 30%

- [ ] **空间分区加速**
  - **工作量**: 5-7 天
  - **技术方案**: 八叉树（Octree）空间索引
  - **复杂度**: O(n²) → O(n log n)
  - **适用场景**: 超过 500 件货物

---

### 优先级 P2（锦上添花）

#### 视觉增强
- [ ] **装载顺序动画**
  - 需求: 逐步演示货物放置过程
  - 技术: React Spring / Framer Motion
  - 效果: 每 0.5 秒放置一个货物

- [ ] **重心可视化**
  - 需求: 显示整体重心位置（小球标记）
  - 计算: 加权平均所有货物位置
  - 警告: 重心偏离中心超过 20% 时提示

- [ ] **货柜利用率热力图**
  - 需求: 用颜色表示空间密度
  - 技术: Three.js 体素化（Voxelization）

#### 交互优化
- [ ] **货物拖拽排序**
  - 库依赖: react-beautiful-dnd
  - 功能: 手动调整装载优先级

- [ ] **键盘快捷键支持**
  - `Ctrl+Z`: 撤销
  - `Ctrl+Shift+Z`: 重做
  - `Delete`: 删除选中货物
  - `Space`: 开始计算

- [ ] **3D 场景截图功能**
  - 技术: Canvas toDataURL
  - 用途: 分享装箱方案图片

#### 数据管理
- [ ] **货物模板预设**
  - 需求: 保存常用货物尺寸（如"标准纸箱"）
  - 存储: LocalStorage
  - UI: 下拉快捷选择

- [ ] **批量导入货物（CSV/Excel）**
  - 库依赖: papaparse / xlsx
  - 格式: 长,宽,高,重量,数量,易碎

---

## 🔬 技术债务

### 代码质量
- [ ] **添加单元测试**
  - **覆盖率目标**: 80%
  - **框架**: Vitest
  - **重点文件**:
    - `services/packingAlgorithm.ts`（核心算法）
    - `utils/*.ts`（工具函数）
  - **测试用例**:
    - 边界条件（空货物列表、单个货物）
    - 易碎品约束验证
    - 碰撞检测准确性

- [ ] **添加 E2E 测试**
  - **框架**: Playwright
  - **测试场景**:
    - 完整装箱流程
    - 集装箱切换
    - 货物添加/删除

- [ ] **提取自定义 Hooks**
  - `useBoxManager`: 货物增删改查逻辑
  - `useContainerStats`: 统计计算逻辑
  - `usePackingCalculator`: 装箱算法调用封装

### 性能优化
- [ ] **Three.js 渲染优化**
  - 使用 `InstancedMesh` 批量渲染相同货物
  - 启用 Frustum Culling（视锥剔除）
  - 降低阴影贴图分辨率（可选）

- [ ] **代码分割**
  - React.lazy 懒加载组件
  - 路由级别代码分割（未来多页面时）

### 工程化
- [ ] **添加 ESLint 配置**
  - 规则: Airbnb + TypeScript
  - 集成 Prettier 自动格式化

- [ ] **添加 Husky Git Hooks**
  - pre-commit: 运行 lint 和格式化
  - pre-push: 运行测试

- [ ] **CI/CD 自动部署**
  - 平台: GitHub Actions + Vercel
  - 流程: PR 自动预览 + main 分支自动部署

---

## 🌟 未来规划

### v0.2.0（预计 2-3 个月）
**主题**: 用户体验完善
- 货物旋转功能
- 撤销/重做
- 方案导出（JSON + PDF）
- 装箱失败诊断

### v0.5.0（预计 6 个月）
**主题**: 算法升级
- 遗传算法可选
- 多货柜自动分配
- 重心计算与优化
- 装载顺序动画

### v1.0.0（预计 1 年）
**主题**: 企业级功能
- 后端 API 集成（用户账户、云端保存）
- 多用户协作（实时同步）
- AI 智能推荐方案
- 移动端适配

### v2.0.0（长期愿景）
**主题**: 沉浸式体验
- VR/AR 查看模式
- 物理引擎仿真（碰撞、重力）
- 数字孪生集成（IoT 传感器数据）

---

## 📋 开发规范

### 提交前检查清单
- [ ] `npm run build` 无错误
- [ ] 控制台无警告信息
- [ ] 代码已格式化（Prettier）
- [ ] 添加必要注释
- [ ] 更新相关文档（BLUEPRINT.md / CLAUDE.md）
- [ ] 测试通过（如有测试）

### Commit 消息规范
```
<type>(<scope>): <subject>

<body>

<footer>
```

**类型 (type):**
- `feat`: 新功能
- `fix`: 修复 Bug
- `docs`: 文档更新
- `style`: 代码格式（不影响逻辑）
- `refactor`: 重构
- `perf`: 性能优化
- `test`: 测试相关
- `chore`: 构建/工具配置

**示例:**
```
feat(algorithm): 添加货物旋转支持

- 修改 BoxItem 接口添加 rotation 字段
- 更新 calculatePacking 函数支持 6 种朝向
- 在 ControlPanel 添加旋转预览按钮

Closes #42
```

---

## 🐛 已知问题

### 低优先级 Bug
1. **货物悬停 Tooltip 闪烁**
   - 原因: 鼠标在边缘时频繁触发 onPointerOver/Out
   - 影响: 轻微体验问题
   - 计划修复版本: v0.2.0

2. **集装箱切换时货物未自动重置**
   - 原因: 只更新容器规格，未触发重新计算
   - 临时方案: 用户手动点击"重置位置"
   - 计划修复版本: v0.1.1

3. **浏览器缩放时 3D 场景模糊**
   - 原因: devicePixelRatio 未动态更新
   - 影响: 仅在手动缩放浏览器时
   - 计划修复版本: v0.3.0

---

## 📞 任务协作

### 认领任务流程
1. 在 GitHub Issues 中找到任务
2. 评论 "我想认领这个任务"
3. 维护者分配后开始开发
4. 提交 PR 并关联 Issue

### 任务优先级定义
- **P0**: 影响核心功能，需 1 周内修复
- **P1**: 重要功能，可安排到下个版本
- **P2**: 优化改进，按需排期

---

**任务清单维护者**: 项目团队
**更新频率**: 每周一更新
**下次审查日期**: 2025-01-28
